<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Biite.Pages.HomePage"
             Title="Home">
    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Text="Create Event" BackgroundColor="#E4A44D" TextColor="Black" Clicked="CreateEvent_Clicked"/>
                <Button Grid.Column="1" Text="Add Review" BackgroundColor="#E4A44D" TextColor="Black" Clicked="AddReview_Clicked"/>
            </Grid>

            <VerticalStackLayout Spacing="16" IsVisible="{Binding HasRecentReview}">
                <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid ColumnDefinitions="*,Auto">
                    <Label Text="My Recent Reviews" FontAttributes="Bold" FontSize="18"/>
                    
                </Grid>
                    <Frame Grid.Row="1" Padding="12" CornerRadius="12" BackgroundColor="GhostWhite" Opacity="0.9">
                        <VerticalStackLayout>
                            <Label Text="{Binding LastReview.RestaurantName}" FontAttributes="Bold"/>
                            <Label Text="{Binding LastReview.ReviewSnippet}"/>
                            <Label Text="{Binding LastReview.Stars, StringFormat='{0} stars'}"/>
                            <Frame Grid.Row="1" IsVisible="{Binding LastReview.HasPhoto}" Padding="0" CornerRadius="8" HeightRequest="150" HasShadow="False" Margin="0,5">
                                <Image Source="{Binding LastReview.ImageFilePath}" Aspect="AspectFill"/>
                            </Frame>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>
            </VerticalStackLayout>

            <!-- Nearby Restaurants hardcoded instead of pulling from DatabaseService for cleaner look-->
            <Grid RowDefinitions="Auto,Auto">
                <Label Text="Nearby Restaurants" FontAttributes="Bold" FontSize="18"/>
                <VerticalStackLayout Grid.Row="1" Spacing="10">
                    <!-- Mario's Italian -->
                    <Frame Padding="12" CornerRadius="12" BackgroundColor="GhostWhite" Opacity="0.92">
                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                            <Label Text="Mario's Italian" FontAttributes="Bold"/>
                            <Label Grid.Row="1" Text="Italian"/>
                            <HorizontalStackLayout Grid.Column="1" Grid.RowSpan="2" Spacing="8" VerticalOptions="Center">
                                <Label Text="$$"/>
                                <Label Text="4.5 stars"/>
                                <Label Text="0.5 km"/>
                            </HorizontalStackLayout>
                        </Grid>
                    </Frame>

                    <!-- Sushi Palace -->
                    <Frame Padding="12" CornerRadius="12" BackgroundColor="GhostWhite" Opacity="0.92">
                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                            <Label Text="Sushi Palace" FontAttributes="Bold"/>
                            <Label Grid.Row="1" Text="Japanese"/>
                            <HorizontalStackLayout Grid.Column="1" Grid.RowSpan="2" Spacing="8" VerticalOptions="Center">
                                <Label Text="$$$"/>
                                <Label Text="4.8 stars"/>
                                <Label Text="0.8 km"/>
                            </HorizontalStackLayout>
                        </Grid>
                    </Frame>
                </VerticalStackLayout>
            </Grid>

            <!-- Upcoming Events -->
            <Grid RowDefinitions="Auto,Auto">
                <Label Text="Upcoming Events" FontAttributes="Bold" FontSize="18"/>

                <CollectionView Grid.Row="1" ItemsSource="{Binding Upcoming}" SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="12" 
                                   CornerRadius="12" 
                                   BackgroundColor="GhostWhite" 
                                   Opacity="0.92"
                                   Margin="0,0,0,10">
                                <VerticalStackLayout>
                                    <Label Text="{Binding Title}" FontAttributes="Bold"/>
                                    <Label Text="{Binding When}"/>
                                    <Label Text="{Binding TotalPeople, StringFormat='{0} people'}"/>
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>